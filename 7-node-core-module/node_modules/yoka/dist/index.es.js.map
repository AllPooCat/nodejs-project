{"version":3,"file":"index.es.js","sources":["../src/dom.ts","../src/view.ts","../src/refresher.ts","../src/jsx/factory.ts"],"sourcesContent":["export class Dom {\n    static querySelector: (<E extends Element = Element>(el: Element, selectors: string) => E[]) |\n        undefined = undefined;\n\n    static mount(el: Node, parentNode: Node, beforeNode?: Node) {\n        if (beforeNode) {\n            parentNode.insertBefore(el, beforeNode);\n        }\n        else {\n            parentNode.appendChild(el);\n        }\n    }\n\n    static unmount(el: Node) {\n        if (el.parentNode) {\n            el.parentNode.removeChild(el);\n        }\n    }\n\n    static find<E extends Element = Element>(el: Element, selectors: string): E | null {\n        const results = Dom.findAll<E>(el, selectors);\n        if (results.length > 0) {\n            return results[0];\n        }\n        else {\n            return null;\n        }\n    }\n\n    static findAll<E extends Element = Element>(el: Element, selectors: string): E[] {\n        if (Dom.querySelector) {\n            return Dom.querySelector(el, selectors);\n        }\n        else {\n            let elements: E[] = [];\n            el.querySelectorAll<E>(selectors).forEach((node) => {\n                elements.push(node);\n            });\n            return elements;\n        }\n    }\n\n}\n","import {Dom} from \"./dom\";\n\nexport interface ViewProps {\n    children?: HTMLElement,\n    willRender?: (context: any) => void;\n    didRender?: (context: any) => void;\n    didMount?: (context: any) => void;\n    didUnmount?: (context: any) => void;\n}\n\nexport abstract class View<P = {}> {\n    props: P & ViewProps;\n    el!: HTMLElement;\n\n    constructor(props?: P & ViewProps) {\n        this.props = props || {} as P & ViewProps;\n    }\n\n    protected abstract render(): HTMLElement;\n\n    create(): HTMLElement {\n        if (this.props.willRender) {\n            this.props.willRender(this);\n        }\n\n        this.el = this.render();\n\n        View.setInstance(this.el, this);\n\n        if (this.props.didRender) {\n            this.props.didRender(this);\n        }\n\n        return this.el;\n    }\n\n    mount(parentNode: Node, beforeNode?: Node) {\n        if (!this.el) {\n            this.create();\n        }\n\n        Dom.mount(this.el, parentNode, beforeNode);\n\n        if (this.props.didMount) {\n            this.props.didMount(this);\n        }\n\n        this.getSubViews().forEach(view => {\n            if (view.props.didMount) {\n                view.props.didMount(view);\n            }\n        });\n    }\n\n    unmount() {\n        Dom.unmount(this.el);\n\n        if (this.props.didUnmount) {\n            this.props.didUnmount(this);\n        }\n\n        this.getSubViews().forEach(view => {\n            if (view.props.didUnmount) {\n                view.props.didUnmount(view);\n            }\n        });\n    }\n\n    refresh() {\n        //not mounted\n        if (!this.el.parentNode) {\n            this.create();\n            return;\n        }\n\n        //get before node\n        const parentNode = this.el.parentNode;\n        let beforeNode: Node | undefined = undefined;\n        for (let i = 0; i < parentNode.childNodes.length; i++) {\n            if (parentNode.childNodes[i] === this.el) {\n                if (i + 1 < parentNode.childNodes.length) {\n                    beforeNode = parentNode.childNodes[i + 1];\n                }\n                break;\n            }\n        }\n\n        this.unmount();\n        this.create();\n        this.mount(parentNode, beforeNode);\n    }\n\n    delay(timespan: number): Promise<void> {\n        return new Promise((resolve) => {\n            setTimeout(() => {\n                resolve();\n            }, timespan);\n        });\n    }\n\n    async test() {\n        console.log(new Date().toJSON());\n        await this.delay(3000);\n        console.log(\"Abcd\".startsWith('Ab') ? 'xx' : 'yy');\n        console.log(new Date().toJSON());\n    }\n\n\n    //utility\n\n    find<E extends Element = Element>(selectors: string): E | null {\n        return Dom.find<E>(this.el, selectors);\n    }\n\n    findAll<E extends Element = Element>(selectors: string): E[] {\n        return Dom.findAll<E>(this.el, selectors);\n    }\n\n    private static setInstance(element: Node, instance: View) {\n        (element as any).yokaViewInstance = instance;\n    }\n\n    static getInstance(element: Node): View | undefined {\n        const instance = (element as any).yokaViewInstance;\n        return instance ? instance : undefined;\n    }\n\n    getSubViews(): View[] {\n        return this.getSubViewsInner(this.el);\n    }\n\n    private getSubViewsInner(parentNode: Node): View[] {\n        let views: View[] = [];\n        for (let i = 0; i < parentNode.childNodes.length; i++) {\n            const view = View.getInstance(parentNode.childNodes[i]);\n            if (view) {\n                views.push(view);\n            }\n            this.getSubViewsInner(parentNode.childNodes[i]).forEach((view) => views.push(view));\n        }\n        return views;\n    }\n\n}\n","import {View} from \"./view\";\n\nexport interface RefresherProps {\n    render: () => HTMLElement;\n}\n\nexport class Refresher extends View<RefresherProps> {\n    protected render(): HTMLElement {\n        return this.props.render();\n    }\n}\n","const Fragment = \"<></>\";\n\nfunction appendChild(parent: Node, child: any) {\n    if (typeof child === \"undefined\" || child === null) {\n        return;\n    }\n\n    if (Array.isArray(child)) {\n        for (const value of child) {\n            appendChild(parent, value);\n        }\n    }\n    else if (typeof child === \"string\") {\n        parent.appendChild(document.createTextNode(child));\n    }\n    else if (child instanceof Node) {\n        parent.appendChild(child);\n    }\n    else if (typeof child === \"boolean\") {\n        // <>{condition && <a>Display when condition is true</a>}</>\n        // if condition is false, the child is a boolean, but we don't want to display anything\n    }\n    else if (typeof child === 'object' && typeof child['render'] === 'function') {\n        parent.appendChild(child['render']());\n    }\n    else {\n        parent.appendChild(document.createTextNode(String(child)));\n    }\n}\n\nexport function createElement(tagName: any, attributes: JSX.AttributeCollection | null, ...children: any[]): Element | DocumentFragment {\n    if (tagName === Fragment) {\n        return document.createDocumentFragment();\n    }\n    else if (typeof tagName === 'function') {\n        const props: any = {\n            children: children\n        };\n\n        if (attributes) {\n            for (const key of Object.keys(attributes)) {\n                props[key] = attributes[key];\n            }\n        }\n\n        return new tagName(props).create();\n    }\n    else if (typeof tagName === 'string') {\n        const element = document.createElement(tagName);\n\n        if (attributes) {\n            for (const key of Object.keys(attributes)) {\n                const attributeValue = attributes[key];\n\n                if (key === \"className\") { // JSX does not allow class as a valid name\n                    element.setAttribute(\"class\", attributeValue);\n                }\n                else if (key.substr(0,2) === \"on\" && typeof attributes[key] === \"function\") {\n                    element.addEventListener(key.substring(2), attributeValue);\n                }\n                else {\n                    // <input disable />      { disable: true }\n                    // <input type=\"text\" />  { type: \"text\"}\n                    if (typeof attributeValue === \"boolean\" && attributeValue) {\n                        element.setAttribute(key, \"\");\n                    }\n                    else {\n                        element.setAttribute(key, attributeValue);\n                    }\n                }\n            }\n        }\n\n        for (const child of children) {\n            appendChild(element, child);\n        }\n\n        return element;\n    }\n    else {\n        throw new Error('Element Not Supports.');\n    }\n}\n"],"names":[],"mappings":"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"}